{% extends 'base.html' %}
{% block content %}
<style>
  #barChart4 .apexcharts-bar {
    height: 10px;
  }

  #barChart4 .apexcharts-bar path {
    stroke-width: 2px;
  }
</style>
<!--begin::Content wrapper-->
<div class="d-flex flex-column flex-column-fluid">
  <!--begin::Toolbar-->
  <div id="kt_app_toolbar" class="app-toolbar py-3 py-lg-6">
    <!--begin::Toolbar container-->
    <div id="kt_app_toolbar_container" class="app-container container-xxl d-flex flex-stack">
      <!--begin::Page title-->
      <div class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
        <!--begin::Title-->
        <h1 class="page-heading d-flex text-dark fw-bold fs-3 flex-column justify-content-center my-0">Relatório
        </h1>
        <!--end::Title-->
        <!--begin::Breadcrumb-->
        <ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1">
          <!--begin::Item-->
          <li class="breadcrumb-item text-muted">
            <a href="#" class="text-muted text-hover-primary">Home</a>
          </li>
          <!--end::Item-->
          <!--begin::Item-->
          <li class="breadcrumb-item">
            <span class="bullet bg-gray-400 w-5px h-2px"></span>
          </li>
          <!--end::Item-->
          <!--begin::Item-->
          <li class="breadcrumb-item text-muted">Relatório</li>
          <!--end::Item-->
        </ul>
        <!--end::Breadcrumb-->
      </div>
      <!--end::Page title-->

    </div>
    <!--end::Toolbar container-->
  </div>
  <!--end::Toolbar-->
  <!--begin::Content-->
  <div id="kt_app_content" class="app-content flex-column-fluid">
    <!--begin::Content container-->
    <div id="kt_app_content_container" class="app-container container-xxl">
      <!--begin::Contacts App- Add New Contact-->
      <div class="row g-7">
        <div class="col-xl-12">
          <!--begin::Contacts-->
          <div class="card card-flush h-lg-100" id="kt_contacts_main">
            <!--begin::Card header-->
            <div class="card-header pt-7" id="kt_chat_contacts_header">
              <!--begin::Card title-->
              <div class="card-title">
                <i class="ki-duotone ki-badge fs-1 me-2">
                  <span class="path1"></span>
                  <span class="path2"></span>
                  <span class="path3"></span>
                  <span class="path4"></span>
                  <span class="path5"></span>
                </i>
                <h2 style="margin-right: 10px;">Pacientes atendidos x Não atendidos:</h2>
                <i class="bi bi-question-circle-fill" style="font-size: 1.5rem; color: #6c757d;" data-toggle="tooltip"
                  data-placement="top" title="Total de consultas nesse período, total atendido e não atendido."></i>
              </div>
              <!--end::Card title-->
            </div>
            <!--end::Card header-->
            <!--begin::Card body-->
            <div class="card-body pt-5">
              <!--begin::Form-->
              <form id="kt_ecommerce_settings_general_form" action="" method="POST">
                {% csrf_token %}
                <!--begin::Row-->
                <!--begin::Row-->
                <div class="row row-cols-1 row-cols-sm-1 rol-cols-md-1 row-cols-lg-1">
                  <!--begin::Col-->
                  <div class="col">
                    <div class="card">
                      <div class="card-body">
                        <!-- Bar Chart -->
                        <div id="barChart7"></div>
                        <script>
                          document.addEventListener("DOMContentLoaded", () => {
                            new ApexCharts(document.querySelector("#barChart7"), {
                              series: [{
                                data: [{{ cnt_pacientes_total }}, {{ cnt_pacientes_nao_atendido }}, {{ cnt_pacientes_atendidos }}]
                                  }],
                            chart: {
                            type: 'bar',
                            height: 180,
                          },
                            plotOptions: {
                            bar: {
                              borderRadius: 4,
                              horizontal: true,
                            }
                          },
                            dataLabels: {
                            enabled: true,
                            position: 'right',
                            style: {
                              colors: ['#ffffff'],
                              fontSize: '14px' // Define a cor preta para os números
                            },
                            formatter: function (value, { seriesIndex, dataPointIndex, w }) {
                              // Adiciona o rótulo em negrito ao lado das barras
                              return value;
                            }
                          },
                            xaxis: {
                            categories: ['Total de Pacientes', 'Pacientes Não Atendidos', 'Pacientes Atendidos'],
                          },
                            tooltip: {
                            enabled: false // Desabilita o tooltip padrão para evitar o problema
                          }
                              }).render();
                          });
                        </script>
                        <!-- End Bar Chart -->

                      </div>
                    </div>
                  </div>
                  <!--end::Col-->
                </div>
                <!--end::Row-->


            </div>
            <!--end::Row-->
            <!--begin::Separator-->
            <div class="separator mb-4"></div>
            <!--end::Separator-->
            <!--begin::Action buttons-->
            <div class="d-flex justify-content-center align-items-center mb-4">

            </div>
            <!--end::Action buttons-->
            </form>
            <!--end::Form-->
          </div>
          <!--end::Card body-->
        </div>
        <!--begin::Content-->
        <div class="col-xl-12">
          <!--begin::Contacts-->
          <div class="card card-flush h-lg-100" id="kt_contacts_main">
            <!--begin::Card header-->
            <div class="card-header pt-7" id="kt_chat_contacts_header">
              <!--begin::Card title-->
              <div class="card-title">
                <i class="ki-duotone ki-badge fs-1 me-2">
                  <span class="path1"></span>
                  <span class="path2"></span>
                  <span class="path3"></span>
                  <span class="path4"></span>
                  <span class="path5"></span>
                </i>
                <h2 style="margin-right: 10px;">Relatório Geral:</h2>
                <i class="bi bi-question-circle-fill" style="font-size: 1.5rem; color: #6c757d;" data-toggle="tooltip"
                  data-placement="top" title="Total de consultas nesse período dividido por tipos de consultas"></i>
              </div>
              <!--end::Card title-->
            </div>
            <!--end::Card header-->
            <!--begin::Card body-->
            <div class="card-body pt-5">
              <!--begin::Form-->
              <form id="kt_ecommerce_settings_general_form" action="" method="POST">
                {% csrf_token %}
                <!--begin::Row-->
                <!--begin::Row-->
                <div class="row row-cols-1 row-cols-sm-1 rol-cols-md-1 row-cols-lg-1">
                  <!--begin::Col-->
                  <div class="col">
                    <div class="card">
                      <div class="card-body">
                        <!-- Bar Chart -->
                        <div id="barChart"></div>
                        <script>
                          document.addEventListener("DOMContentLoaded", () => {
                            new ApexCharts(document.querySelector("#barChart"), {
                              series: [{
                                data: [{{ cnt_primeira_consulta }}, {{ cnt_consulta_subsequente }}, {{ cnt_consulta_retorno }}]
                                  }],
                            chart: {
                            type: 'bar',
                            height: 180
                          },
                            plotOptions: {
                            bar: {
                              borderRadius: 4,
                              horizontal: true,
                            }
                          },
                            dataLabels: {
                            enabled: true,
                            position: 'right',
                            style: {
                              fontSize: '14px', // Defina o tamanho da fonte desejado
                            },
                            formatter: function (value, { seriesIndex, dataPointIndex, w }) {
                              // Adiciona a label e a cor personalizada ao lado das barras
                              const categories = w.config.xaxis.categories;
                              const colors = ['#FF5733', '#33FF57', '#5733FF']; // Defina as cores desejadas
                              const label = categories[dataPointIndex];
                              const color = colors[dataPointIndex];
                              return value;
                            }
                          },
                            xaxis: {
                            categories: ['Primeira Consulta', 'Consulta Subsequente', 'Retorno'],
                          },
                            tooltip: {
                            enabled: false // Desabilita o tooltip padrão para evitar o problema
                          }
                              }).render();
                          });
                        </script>
                        <!-- End Bar Chart -->

                      </div>
                    </div>
                  </div>
                  <!--end::Col-->
                </div>
                <!--end::Row-->


            </div>
            <!--end::Row-->
            <!--begin::Separator-->
            <div class="separator mb-4"></div>
            <!--end::Separator-->
            <!--begin::Action buttons-->
            <div class="d-flex justify-content-center align-items-center mb-4">

            </div>
            <!--end::Action buttons-->
            </form>
            <!--end::Form-->
          </div>
          <!--end::Card body-->
        </div>

        <!--end::Contacts-->
        <div id="heatmapp" style="height: 200px;"></div>
        <script>
          anychart.onDocumentReady(function () {
            let chart = anychart.heatMap(getData({{ resultadoCons|safe }}));
        
            chart.title("Pacientes agendados na clínica hoje por hora");
        
            chart.container("heatmapp");

            chart.labels()
              .fontColor("#ffffff")  // Define a cor do texto para branco
              .fontWeight("bold");   // Torna o texto em negrito
        
            chart.draw();
          });
        
          function getData(resultadoCons) {
            let data = resultadoCons.map(function (item) {
              return {
                x: item.hora.split(' ')[1], // Pega apenas a hora da string
                y: "HOJE",
                heat: item.contagem
              };
            });
        
            return data;
          }
        </script>
        <div class="col-xl-12">
          <!--begin::Contacts-->
          <div class="card card-flush h-lg-100" id="kt_contacts_main">
            <!--begin::Card header-->
            <div class="card-header pt-7" id="kt_chat_contacts_header">
              <!--begin::Card title-->
              <div class="card-title">
                <i class="ki-duotone ki-badge fs-1 me-2">
                  <span class="path1"></span>
                  <span class="path2"></span>
                  <span class="path3"></span>
                  <span class="path4"></span>
                  <span class="path5"></span>
                </i>
                <h2 style="margin-right: 10px;">Primeira Consulta:</h2>
                <i class="bi bi-question-circle-fill" style="font-size: 1.5rem; color: #6c757d;" data-toggle="tooltip"
                  data-placement="top" title="Quantidade de primeiras consultas dividido por médico"></i>
              </div>
              <!--end::Card title-->
            </div>
            <!--end::Card header-->
            <!--begin::Card body-->
            <div class="card-body pt-5">
              <!--begin::Form-->
              <form id="kt_ecommerce_settings_general_form" action="" method="POST">
                {% csrf_token %}
                <!--begin::Row-->
                <div class="row row-cols-1 row-cols-sm-1 rol-cols-md-1 row-cols-lg-1">
                  <!--begin::Col-->
                  <div class="col">
                    <div class="card">
                      <div class="card-body">
                        <!-- Bar Chart -->
                        <div id="barChart2"></div>
                        <script>
                          document.addEventListener("DOMContentLoaded", () => {
                            var prestadorData = {{ prestador_p_consulta | safe}};
                            var prestadores = Object.keys(prestadorData);
                            var valores = Object.values(prestadorData);

                          // Organiza os dados em ordem decrescente
                          var sortedData = prestadores.map((prestador, index) => ({ prestador, valor: valores[index] }))
                            .sort((a, b) => b.valor - a.valor);

                          prestadores = sortedData.map(item => item.prestador);
                          valores = sortedData.map(item => item.valor);

                          new ApexCharts(document.querySelector("#barChart2"), {
                            series: [{
                              data: valores
                            }],
                            chart: {
                              type: 'bar',
                            },
                            plotOptions: {
                              bar: {
                                borderRadius: 4,
                                horizontal: true,
                                barHeight: 20,
                              }
                            },
                            dataLabels: {
                              enabled: true,
                              position: 'right',
                              style: {
                                fontSize: '14px', // Defina o tamanho da fonte desejado
                              },
                              formatter: function (value, { seriesIndex, dataPointIndex, w }) {
                                return value;
                              }
                            },
                            xaxis: {
                              categories: prestadores,
                            }
                          }).render();
                          });
                        </script>
                        <!-- End Bar Chart -->
                      </div>
                    </div>
                  </div>
                  <!--end::Col-->
                </div>
                <!--end::Row-->

                <!--begin::Separator-->
                <div class="separator mb-4"></div>
                <!--end::Separator-->
                <!--begin::Action buttons-->
                <div class="d-flex justify-content-center align-items-center mb-4">
                </div>
                <!--end::Action buttons-->
              </form>
              <!--end::Form-->
            </div>
            <!--end::Card body-->
          </div>
        </div>

        <div class="col-xl-12">
          <!--begin::Contacts-->
          <div class="card card-flush h-lg-100" id="kt_contacts_main">
            <!--begin::Card header-->
            <div class="card-header pt-7" id="kt_chat_contacts_header">
              <!--begin::Card title-->
              <div class="card-title">
                <i class="ki-duotone ki-badge fs-1 me-2">
                  <span class="path1"></span>
                  <span class="path2"></span>
                  <span class="path3"></span>
                  <span class="path4"></span>
                  <span class="path5"></span>
                </i>
                <h2 style="margin-right: 10px;">Consulta Subsequente:</h2>
                <i class="bi bi-question-circle-fill" style="font-size: 1.5rem; color: #6c757d;" data-toggle="tooltip"
                  data-placement="top" title="Quantidade de consultas subsequentes dividido por médico"></i>
              </div>
              <!--end::Card title-->
            </div>
            <!--end::Card header-->
            <!--begin::Card body-->
            <div class="card-body pt-5">
              <!--begin::Form-->
              <form id="kt_ecommerce_settings_general_form" action="" method="POST">
                {% csrf_token %}
                <!--begin::Row-->
                <!--begin::Row-->
                <div class="row row-cols-1 row-cols-sm-1 rol-cols-md-1 row-cols-lg-1">
                  <!--begin::Col-->
                  <div class="col">
                    <div class="card">
                      <div class="card-body">
                        <!-- Bar Chart -->
                        <div id="barChart3"></div>
                        <script>
                          document.addEventListener("DOMContentLoaded", () => {
                            var prestadorData = {{ prestador_s_consulta | safe}};
                          var prestadores = Object.keys(prestadorData);
                          var valores = Object.values(prestadorData);

                          // Organiza os dados em ordem decrescente
                          var sortedData = prestadores.map((prestador, index) => ({ prestador, valor: valores[index] }))
                            .sort((a, b) => b.valor - a.valor);

                          prestadores = sortedData.map(item => item.prestador);
                          valores = sortedData.map(item => item.valor);

                          new ApexCharts(document.querySelector("#barChart3"), {
                            series: [{
                              data: valores
                            }],
                            chart: {
                              type: 'bar',
                            },
                            plotOptions: {
                              bar: {
                                borderRadius: 4,
                                horizontal: true,
                                barHeight: 20,
                              }
                            },
                            dataLabels: {
                              enabled: true,
                              position: 'right',
                              style: {
                                fontSize: '14px', // Defina o tamanho da fonte desejado
                              },
                              formatter: function (value, { seriesIndex, dataPointIndex, w }) {
                                return value;
                              }
                            },
                            xaxis: {
                              categories: prestadores,
                            }
                          }).render();
                          });
                        </script>
                        <!-- End Bar Chart -->

                      </div>
                    </div>
                  </div>
                  <!--end::Col-->
                </div>
                <!--end::Row-->

                <!--begin::Col-->

                <!--end::Col-->
            </div>
            <!--end::Row-->
            <!--begin::Separator-->
            <div class="separator mb-4"></div>
            <!--end::Separator-->
            <!--begin::Action buttons-->
            <div class="d-flex justify-content-center align-items-center mb-4">

            </div>
            <!--end::Action buttons-->
            </form>
            <!--end::Form-->
          </div>
          <!--end::Card body-->
        </div>
        <div class="col-xl-12">
          <!--begin::Contacts-->
          <div class="card card-flush h-lg-100" id="kt_contacts_main">
            <!--begin::Card header-->
            <div class="card-header pt-7" id="kt_chat_contacts_header">
              <!--begin::Card title-->
              <div class="card-title">
                <i class="ki-duotone ki-badge fs-1 me-2">
                  <span class="path1"></span>
                  <span class="path2"></span>
                  <span class="path3"></span>
                  <span class="path4"></span>
                  <span class="path5"></span>
                </i>
                <h2 style="margin-right: 10px;">Consulta de Retorno:</h2>
                <i class="bi bi-question-circle-fill" style="font-size: 1.5rem; color: #6c757d;" data-toggle="tooltip"
                  data-placement="top" title="Quantidade de consultas de retorno dividido por médico"></i>
              </div>
              <!--end::Card title-->
            </div>
            <!--end::Card header-->
            <!--begin::Card body-->
            <div class="card-body pt-5">
              <!--begin::Form-->
              <form id="kt_ecommerce_settings_general_form" action="" method="POST">
                {% csrf_token %}
                <!--begin::Row-->
                <!--begin::Row-->
                <div class="row row-cols-1 row-cols-sm-1 rol-cols-md-1 row-cols-lg-1">
                  <!--begin::Col-->
                  <div class="col">
                    <div class="card">
                      <div class="card-body">
                        <!-- Bar Chart -->
                        <div id="barChart4"></div>
                        <script>
                          document.addEventListener("DOMContentLoaded", () => {
                            var prestadorData = {{ prestador_r_consulta | safe}};
                          var prestadores = Object.keys(prestadorData);
                          var valores = Object.values(prestadorData);

                          // Organiza os dados em ordem decrescente
                          var sortedData = prestadores.map((prestador, index) => ({ prestador, valor: valores[index] }))
                            .sort((a, b) => b.valor - a.valor);

                          prestadores = sortedData.map(item => item.prestador);
                          valores = sortedData.map(item => item.valor);

                          new ApexCharts(document.querySelector("#barChart4"), {
                            series: [{
                              data: valores
                            }],
                            chart: {
                              type: 'bar',
                            },
                            plotOptions: {
                              bar: {
                                borderRadius: 4,
                                horizontal: true,
                                barHeight: 20,
                              }
                            },
                            dataLabels: {
                              enabled: true,
                              position: 'right',
                              style: {
                                fontSize: '14px', // Defina o tamanho da fonte desejado
                              },
                              formatter: function (value, { seriesIndex, dataPointIndex, w }) {
                                return value;
                              }
                            },
                            xaxis: {
                              categories: prestadores,
                            }
                          }).render();
                          });
                        </script>
                        <!-- End Bar Chart -->

                      </div>
                    </div>
                  </div>
                  <!--end::Col-->
                </div>
                <!--end::Row-->


            </div>

            <!--end::Row-->
            <!--begin::Separator-->
            <div class="separator mb-4"></div>
            <!--end::Separator-->
            <!--begin::Action buttons-->
            <div class="d-flex justify-content-center align-items-center mb-4">

            </div>
            <!--end::Action buttons-->
            </form>
            <!--end::Form-->
          </div>
          <!--end::Card body-->
        </div>
        <div class="col-lg-12">

          <div class="row">

            <!-- Reports -->
            <div class="col-lg-12">
              <div class="card card-flush h-lg-100" id="kt_contacts_main">
                <!--begin::Card header-->
                <div class="card-header pt-7" id="kt_chat_contacts_header">
                  <!--begin::Card title-->
                  <div class="card-title">
                    <i class="ki-duotone ki-badge fs-1 me-2">
                      <span class="path1"></span>
                      <span class="path2"></span>
                      <span class="path3"></span>
                      <span class="path4"></span>
                      <span class="path5"></span>
                    </i>
                    <h2 style="margin-right: 10px;">Total por Médico:</h2>
                    <i class="bi bi-question-circle-fill" style="font-size: 1.5rem; color: #6c757d;"
                      data-toggle="tooltip" data-placement="top"
                      title="Total de consultas e exames divididos por médico"></i>
                  </div>
                  <!--end::Card title-->
                </div>
                <!--end::Card header-->
                <!--begin::Card body-->
                <div class="card-body pt-5">
                  <!--begin::Form-->
                  <form id="kt_ecommerce_settings_general_form" action="" method="POST">
                    {% csrf_token %}
                    <!--begin::Row-->
                    <!--begin::Row-->
                    <div class="row row-cols-1 row-cols-sm-1 rol-cols-md-1 row-cols-lg-1">
                      <!--begin::Col-->
                      <div class="col">
                        <div class="card">
                          <div class="card-body">

                            <!-- Bar Chart -->
                            <div id="barChart5"></div>

                            <script>
                              document.addEventListener("DOMContentLoaded", () => {
                                var prestador_count = {{ prestador_cnt | safe}};
                              var prestadores = Object.keys(prestador_count);
                              var contagens = Object.values(prestador_count);

                              // Organiza os dados em ordem decrescente
                              var sortedData = prestadores.map((prestador, index) => ({ prestador, contagem: contagens[index] }))
                                .sort((a, b) => b.contagem - a.contagem);

                              prestadores = sortedData.map(item => item.prestador);
                              contagens = sortedData.map(item => item.contagem);

                              new ApexCharts(document.querySelector("#barChart5"), {
                                series: [{
                                  data: contagens,
                                }],
                                chart: {
                                  type: 'bar',
                                },
                                plotOptions: {
                                  bar: {
                                    borderRadius: 4,
                                    horizontal: true,
                                    barHeight: 20,
                                  }
                                },
                                dataLabels: {
                                  enabled: true,
                                  position: 'right',
                                  style: {
                                    fontSize: '14px', // Defina o tamanho da fonte desejado
                                  },
                                  formatter: function (value, { seriesIndex, dataPointIndex, w }) {
                                    return value;
                                  }
                                },
                                xaxis: {
                                  categories: prestadores,
                                },
                              }).render();
                              });
                            </script>
                            <!-- End Bar Chart -->

                          </div>
                        </div>
                      </div><!-- End Reports -->


                    </div>
                </div>


                <!--end::Content-->
              </div>
              <!--end::Contacts App- Add New Contact-->
            </div>
            <!--end::Content container-->
          </div>
          <!--end::Content-->
        </div>


        <!--end::Content wrapper-->
        <script>
          // Adicione esse script para ativar os tooltips
          $(function () {
            $('[data-toggle="tooltip"]').tooltip()
          })
        </script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>




        {% endblock %}